<Project TreatAsLocalProperty="IsCrossTargetingProject;EditorConfigDir">
  <PropertyGroup>
    <IsCrossTargetingProject Condition="$(TargetFrameworks) != ''">true</IsCrossTargetingProject>
  </PropertyGroup>
  <Target
    Name="UpdateEditorConfig"
    BeforeTargets="DispatchToInnerBuilds;BeforeBuild"
    Condition=" '$(IsCrossTargetingProject)' == '$(IsCrossTargetingBuild)' "
  >
    <PropertyGroup>
      <EditorConfigDir>$(SolutionDir)</EditorConfigDir>
      <EditorConfigDir Condition=" '$(EditorConfigDir)' == '' or '$(EditorConfigDir)' == '*Undefined*' "
        >$([MSBuild]::GetDirectoryNameOfFileAbove($(ProjectDir), Directory.Packages.props))</EditorConfigDir
      >
    </PropertyGroup>
    <Copy
      SourceFiles="$(MSBuildThisFileDirectory)../configurations/editorconfig.txt"
      DestinationFiles="$(EditorConfigDir).editorconfig"
      OverwriteReadOnlyFiles="false"
      SkipUnchangedFiles="true"
      ContinueOnError="WarnAndContinue"
    />
  </Target>
</Project>
